# Patrones de Integracion

**Tiempo estimado**: 30 minutos
**Nivel**: Intermedio-Avanzado
**Prerrequisitos**: Matriz de Interaccion Aplicacion-Datos (4.2.2)

---

## Por que importa este subtema?

La integracion entre aplicaciones es donde la arquitectura de SI cobra vida. Sin integracion, cada aplicacion es un silo. La eleccion del patron de integracion afecta:

- Acoplamiento entre sistemas
- Latencia y rendimiento
- Complejidad de mantenimiento
- Costos de implementacion

---

## Categorias de Integracion

### Por estilo

| Estilo | Descripcion | Uso tipico |
|--------|-------------|------------|
| **Punto a punto** | Conexion directa entre 2 sistemas | Integraciones simples |
| **Hub and Spoke** | Bus central que conecta todos | ESB tradicional |
| **Event-driven** | Sistemas publican/suscriben eventos | Microservicios, tiempo real |
| **API-led** | Capas de APIs con propositos distintos | API Management |

### Por sincronismo

| Tipo | Descripcion | Cuando usar |
|------|-------------|-------------|
| **Sincrono** | Emisor espera respuesta | Consultas, validaciones |
| **Asincrono** | Emisor no espera | Procesamiento batch, eventos |

### Por patron de intercambio

| Patron | Descripcion | Ejemplo |
|--------|-------------|---------|
| **Request-Response** | Pregunta y respuesta | Consultar precio |
| **Fire and Forget** | Enviar sin esperar | Notificacion |
| **Publish-Subscribe** | Publicar a multiples suscriptores | Evento de pedido creado |
| **Batch Transfer** | Transferencia masiva | ETL nocturno |

---

## Patrones Detallados

### 1. API REST

```
Cliente                    Servidor
   |                          |
   |  GET /customers/123      |
   |------------------------->|
   |                          |
   |  200 OK                  |
   |  {"id":123,"name":"..."}|
   |<-------------------------|
   |                          |
```

**Caracteristicas**:
- Sincrono
- Stateless
- Basado en recursos (URLs)
- Verbos HTTP (GET, POST, PUT, DELETE)

**Cuando usar**:
- Consultas simples
- CRUD sobre recursos
- Integracion con terceros
- APIs publicas

**Ejemplo**:
```
GET  /api/v1/customers/123        # Leer cliente
POST /api/v1/orders               # Crear pedido
PUT  /api/v1/orders/456/status    # Actualizar estado
```

---

### 2. Mensajeria Asincrona (Message Queue)

```
Productor          Cola            Consumidor
   |                |                   |
   | Mensaje        |                   |
   |--------------->|                   |
   |                |    Poll/Push      |
   |                |------------------>|
   |                |                   |
   |                |     ACK           |
   |                |<------------------|
```

**Caracteristicas**:
- Asincrono
- Desacoplamiento temporal
- Garantia de entrega
- Orden (dependiendo de cola)

**Cuando usar**:
- Procesamiento que puede diferirse
- Picos de carga
- Sistemas con diferente disponibilidad

**Tecnologias**: RabbitMQ, Amazon SQS, Azure Service Bus

---

### 3. Event-Driven (Pub/Sub)

```
                    Event Broker
                    (Kafka, etc.)
                         |
                    +----+----+
                    | Topic:  |
                    | pedido- |
                    | creado  |
                    +----+----+
                   /     |     \
                  /      |      \
           +-----+  +----+---+  +------+
           | CRM |  | ERP    |  | Email|
           +-----+  +--------+  +------+
           Suscribe  Suscribe   Suscribe

Productor: Portal publica evento "pedido-creado"
Consumidores: CRM, ERP, Email se suscriben al topico
```

**Caracteristicas**:
- Asincrono
- Desacoplamiento completo
- Multiples consumidores
- Escalabilidad horizontal

**Cuando usar**:
- Notificar multiples sistemas de un evento
- Microservicios
- Event sourcing
- Tiempo real

**Tecnologias**: Apache Kafka, AWS SNS/SQS, Azure Event Hub

---

### 4. API Gateway

```
                    +-------------+
                    | API Gateway |
                    +------+------+
                           |
         +-----------------+-----------------+
         |                 |                 |
   +-----+-----+     +-----+-----+     +-----+-----+
   | Servicio  |     | Servicio  |     | Servicio  |
   | Clientes  |     | Pedidos   |     | Pagos     |
   +-----------+     +-----------+     +-----------+
```

**Funciones del Gateway**:
- Autenticacion/Autorizacion
- Rate limiting
- Transformacion de requests
- Routing
- Caching
- Monitoreo

**Tecnologias**: Kong, AWS API Gateway, Azure APIM, Apigee

---

### 5. ETL/ELT (Batch)

```
Fuentes              ETL               Destino
+-------+                              +-------+
| SAP   |--+                       +-->| DWH   |
+-------+  |    +-----------+      |   +-------+
           +--->| Extract   |------+
+-------+  |    | Transform |------+   +-------+
| CRM   |--+    | Load      |      +-->| Lake  |
+-------+       +-----------+          +-------+
                (Nocturno)
```

**Caracteristicas**:
- Batch (no tiempo real)
- Alto volumen
- Transformaciones complejas
- Ventana de procesamiento

**Cuando usar**:
- Data warehousing
- Reportes
- Migraciones
- Sincronizacion masiva

**Tecnologias**: Informatica, Talend, dbt, Apache Spark

---

## Comparacion de Patrones

| Patron | Latencia | Acoplamiento | Complejidad | Volumen |
|--------|----------|--------------|-------------|---------|
| REST API | Baja | Medio | Baja | Bajo-Medio |
| Message Queue | Media | Bajo | Media | Medio |
| Pub/Sub | Baja | Muy bajo | Media-Alta | Alto |
| API Gateway | Baja | Bajo | Media | Medio-Alto |
| ETL Batch | Alta | Bajo | Media | Muy alto |

---

## Seleccion de Patron

### Arbol de decision

```
Necesito respuesta inmediata?
    |
    +-- SI --> Necesito consultar datos?
    |              |
    |              +-- SI --> API REST
    |              |
    |              +-- NO --> Command via API
    |
    +-- NO --> Multiples consumidores?
                   |
                   +-- SI --> Pub/Sub (Kafka)
                   |
                   +-- NO --> Alto volumen?
                                  |
                                  +-- SI --> ETL/Batch
                                  |
                                  +-- NO --> Message Queue
```

### Criterios de seleccion

| Criterio | REST | Queue | Pub/Sub | Batch |
|----------|------|-------|---------|-------|
| Tiempo real requerido | Bueno | Medio | Bueno | Malo |
| Garantia de entrega | Media | Alta | Alta | Alta |
| Ordenamiento | N/A | Si | Depende | N/A |
| Escalabilidad | Media | Alta | Muy alta | Alta |
| Simplicidad | Alta | Media | Baja | Media |

---

## Ejemplo: Arquitectura de Integracion

```
                         +------------------+
                         |   API Gateway    |
                         |   (Kong)         |
                         +--------+---------+
                                  |
                    +-------------+-------------+
                    |                           |
              +-----+-----+               +-----+-----+
              | REST APIs |               | GraphQL   |
              | (Sync)    |               | (Sync)    |
              +-----+-----+               +-----------+
                    |
         +----------+----------+
         |                     |
   +-----+-----+         +-----+-----+
   |Salesforce |         |  SAP ERP  |
   |   API     |         |   API     |
   +-----------+         +-----------+

                    +------------------+
                    |  Event Broker    |
                    |  (Kafka)         |
                    +--------+---------+
                             |
         +-------------------+-------------------+
         |                   |                   |
   +-----+-----+       +-----+-----+       +-----+-----+
   | Order     |       | Inventory |       | Notif     |
   | Service   |       | Service   |       | Service   |
   +-----------+       +-----------+       +-----------+

                    +------------------+
                    |    ETL/DWH       |
                    |  (Batch nocturno)|
                    +--------+---------+
                             |
                    +--------+---------+
                    |   Data Warehouse |
                    |   (Snowflake)    |
                    +------------------+
```

---

## Resumen

| Patron | Mejor para |
|--------|------------|
| REST API | Consultas, CRUD, integracion simple |
| Message Queue | Procesamiento diferido, desacoplamiento |
| Pub/Sub | Eventos, microservicios, tiempo real |
| API Gateway | Centralizacion, seguridad, monitoreo |
| ETL/Batch | Analytics, alto volumen, sincronizacion masiva |

**Siguiente modulo**: Dominios de Arquitectura - Tecnologia (Modulo 5)
