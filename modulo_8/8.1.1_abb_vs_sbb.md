# ABB vs SBB: Building Blocks de Arquitectura

**Tiempo estimado**: 30 minutos
**Nivel**: Intermedio
**Prerrequisitos**: Proceso de Gestion de Cambios (7.2.2)

---

## Por que importa este subtema?

Los Building Blocks son los componentes reutilizables que componen la arquitectura. Entender la diferencia entre Architecture Building Blocks (ABB) y Solution Building Blocks (SBB) es fundamental para disenar arquitecturas que balanceen abstraccion con implementacion practica.

---

## Que son los Building Blocks

> "Un paquete de funcionalidad definido para cumplir con las necesidades de negocio de una organizacion. Un building block tiene interfaces publicadas para acceder a su funcionalidad."

**Caracteristicas**:
- Reutilizables
- Reemplazables
- Bien especificados (interfaces claras)
- Pueden componerse para formar sistemas mayores

---

## ABB vs SBB

```
ABSTRACCION                                    IMPLEMENTACION
    |                                               |
    v                                               v
+----------------+                          +----------------+
|      ABB       |  ---- se realiza --->    |      SBB       |
| (Architecture  |       como               | (Solution      |
|  Building Block)|                         |  Building Block)|
+----------------+                          +----------------+
|                |                          |                |
| - Que hace     |                          | - Como lo hace |
| - Requisitos   |                          | - Tecnologia   |
| - Interfaces   |                          | - Producto     |
| - Capacidades  |                          | - Config       |
|                |                          |                |
+----------------+                          +----------------+

EJEMPLO:
ABB: "Servicio de Autenticacion"            SBB: "Okta Identity Cloud"
     - SSO                                       - Okta Universal Login
     - MFA                                       - Okta Verify MFA
     - Federation                                - SAML 2.0 / OIDC
```

---

## Architecture Building Blocks (ABB)

### Definicion

> "Define QUE funcionalidad se requiere, sin especificar COMO se implementara."

### Caracteristicas

| Aspecto | ABB |
|---------|-----|
| Nivel | Conceptual / Logico |
| Enfoque | Requisitos y capacidades |
| Independencia | De tecnologia y proveedor |
| Durabilidad | Larga (anos) |
| Audiencia | Arquitectos, stakeholders |

### Estructura de un ABB

```markdown
# ABB: Servicio de Mensajeria Asincrona

## Descripcion
Componente que permite la comunicacion asincrona entre servicios
mediante colas de mensajes y eventos.

## Capacidades
- Envio de mensajes punto a punto
- Publicacion/suscripcion (pub/sub)
- Garantia de entrega (at-least-once)
- Persistencia de mensajes
- Dead letter queue

## Requisitos No Funcionales
| Requisito | Especificacion |
|-----------|----------------|
| Throughput | > 10,000 msg/seg |
| Latencia | < 100ms (p99) |
| Disponibilidad | 99.99% |
| Retencion | 7 dias minimo |
| Ordenamiento | Por particion |

## Interfaces
| Interface | Tipo | Descripcion |
|-----------|------|-------------|
| Producer | API | Publicar mensajes |
| Consumer | API | Consumir mensajes |
| Admin | API | Gestionar topics/queues |
| Metrics | Push | Metricas operacionales |

## Dependencias
- Requiere: Servicio de Autenticacion (ABB-AUTH)
- Requiere: Servicio de Logging (ABB-LOG)

## Estandares Aplicables
- CloudEvents 1.0 (formato de eventos)
- AMQP 1.0 o equivalente
```

### Ejemplos de ABBs

| Dominio | ABB | Capacidades Clave |
|---------|-----|-------------------|
| Seguridad | Identity Provider | SSO, MFA, Federation |
| Integracion | API Gateway | Routing, auth, rate limiting |
| Datos | Data Lake | Ingestion, storage, query |
| Aplicacion | BPM Engine | Workflow, rules, forms |
| Infraestructura | Container Platform | Orchestration, scaling |

---

## Solution Building Blocks (SBB)

### Definicion

> "Especifica COMO se implementa un ABB, incluyendo tecnologia especifica, productos y configuracion."

### Caracteristicas

| Aspecto | SBB |
|---------|-----|
| Nivel | Fisico / Implementacion |
| Enfoque | Productos y configuracion |
| Dependencia | De tecnologia y proveedor |
| Durabilidad | Media (meses a anos) |
| Audiencia | Desarrolladores, operaciones |

### Estructura de un SBB

```markdown
# SBB: Apache Kafka (Mensajeria Asincrona)

## ABB Realizado
ABB-MSG-001: Servicio de Mensajeria Asincrona

## Producto
| Aspecto | Detalle |
|---------|---------|
| Producto | Apache Kafka |
| Version | 3.6.x |
| Proveedor | Confluent (Enterprise) |
| Modelo | Managed (Confluent Cloud) |

## Implementacion

### Topologia
```
Region: us-east-1
Clusters:
  - prod-main (6 brokers, 3 AZ)
  - prod-dr (3 brokers, region us-west-2)
Zookeeper: Managed by Confluent
```

### Configuracion Base
```properties
# Broker config
num.partitions=12
default.replication.factor=3
min.insync.replicas=2
log.retention.hours=168
message.max.bytes=1048576
```

### Seguridad
```
Authentication: SASL/OAUTHBEARER (Okta)
Authorization: Confluent RBAC
Encryption: TLS 1.3 in transit, at rest
Network: Private Link
```

## Cumplimiento de ABB

| Capacidad ABB | Implementacion SBB | Cumple |
|---------------|-------------------|--------|
| Punto a punto | Kafka queues | Si |
| Pub/sub | Kafka topics | Si |
| At-least-once | Acks=all | Si |
| Persistencia | Log retention | Si |
| DLQ | Dead letter topic | Si |

| NFR | Requisito | Capacidad SBB |
|-----|-----------|---------------|
| Throughput | > 10K msg/s | 100K msg/s |
| Latencia p99 | < 100ms | ~20ms |
| Disponibilidad | 99.99% | 99.99% SLA |
| Retencion | 7 dias | 7+ dias config |

## Interfaces Especificas

| Interface ABB | Implementacion |
|---------------|----------------|
| Producer API | Confluent Kafka Client |
| Consumer API | Confluent Kafka Client |
| Admin API | Confluent Admin Client |
| Metrics | JMX -> Datadog |

## Operacion

### Monitoreo
- Dashboard: Confluent Control Center
- Alertas: Datadog
- Metricas clave: lag, throughput, errors

### Runbook
- [Link a runbook de operaciones]

### Soporte
- Nivel 1: DevOps team
- Nivel 2: Confluent Support (Enterprise)
```

### Ejemplos de SBBs

| ABB | Posibles SBBs |
|-----|---------------|
| Identity Provider | Okta, Auth0, Azure AD, Keycloak |
| API Gateway | Kong, AWS API GW, Apigee, Azure APIM |
| Data Lake | Databricks, Snowflake, AWS Lake Formation |
| BPM Engine | Camunda, Appian, IBM BPM |
| Container Platform | EKS, AKS, GKE, OpenShift |

---

## Relacion ABB-SBB

```
                 ARQUITECTURA EMPRESARIAL
                          |
     +--------------------+--------------------+
     |                                         |
     v                                         v
+---------+                              +-----------+
|   ABB   |                              |    SBB    |
| Catalog |                              | Catalog   |
+---------+                              +-----------+
     |                                         |
     |  1:N (un ABB puede tener               |
     |       multiples SBBs)                  |
     |                                         |
     v                                         v
+---------+     realiza      +-----------+
| ABB-001 |<----------------|  SBB-001  |  (Produccion)
| Messaging|<----------------|  SBB-002  |  (DR)
+---------+ <----------------|  SBB-003  |  (Dev/Test)
                             +-----------+
```

### Escenarios de Mapeo

| Escenario | ABBs | SBBs | Ejemplo |
|-----------|------|------|---------|
| Standard | 1 | 1 | 1 API Gateway ABB -> 1 Kong SBB |
| Multi-ambiente | 1 | N | 1 DB ABB -> PostgreSQL (prod, dev, test) |
| Multi-proveedor | 1 | N | 1 Cloud ABB -> AWS + Azure |
| Transicion | 1 | 2 | 1 CRM ABB -> Siebel (legacy) + Salesforce (new) |

---

## Proceso de Definicion

### De ABB a SBB

```
1. DEFINIR ABB
   |
   +-- Identificar necesidad de negocio
   +-- Definir capacidades requeridas
   +-- Especificar interfaces
   +-- Documentar NFRs
   |
   v
2. SELECCIONAR SBB
   |
   +-- Evaluar opciones de mercado
   +-- POC/POV si necesario
   +-- Seleccionar producto
   +-- Documentar configuracion
   |
   v
3. IMPLEMENTAR
   |
   +-- Deploy segun estandares
   +-- Validar cumplimiento de ABB
   +-- Documentar operacion
   |
   v
4. GOBERNAR
   |
   +-- Monitorear cumplimiento
   +-- Gestionar ciclo de vida
   +-- Actualizar catalogo
```

---

## Ejemplo Completo: Autenticacion

### ABB

```markdown
# ABB-SEC-001: Servicio de Autenticacion

## Capacidades
- Single Sign-On (SSO)
- Multi-Factor Authentication (MFA)
- Federation (SAML, OIDC)
- Gestion de sesiones
- Audit logging

## Requisitos
- Latencia < 200ms
- Disponibilidad 99.99%
- Compliance: SOC2, ISO27001
```

### SBB Opcion A: Okta

```markdown
# SBB-SEC-001-A: Okta Identity Cloud

## Producto: Okta Workforce Identity
## Modelo: SaaS

## Implementacion
- Okta Universal Login
- Okta Verify (MFA)
- AD/LDAP Integration
- SCIM provisioning
```

### SBB Opcion B: Azure AD

```markdown
# SBB-SEC-001-B: Azure Active Directory

## Producto: Azure AD Premium P2
## Modelo: SaaS (Microsoft)

## Implementacion
- Azure AD SSO
- Microsoft Authenticator
- Conditional Access
- Identity Protection
```

---

## Resumen

| Concepto | ABB | SBB |
|----------|-----|-----|
| Nivel | Abstracto | Concreto |
| Define | Que (requisitos) | Como (implementacion) |
| Independencia | Tecnologia neutral | Tecnologia especifica |
| Durabilidad | Larga | Media |
| Reutilizacion | Alta | Media |

**Siguiente subtema**: Catalogo de Building Blocks (8.1.2)
